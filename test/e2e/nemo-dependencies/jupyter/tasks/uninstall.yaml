- name: check if Jupyter server is installed
  shell: helm list -n {{ namespace }} | egrep 'jupyter' | awk '{print $1}' | wc -l | tr -d '\n'
  register: jupyter_installed
  ignore_errors: true

- name: Uninstall Jupyter server helmchart
  shell: helm list -n {{ namespace }} | awk '{print $1}' | grep -v NAME | egrep 'jupyter' | xargs helm uninstall -n {{ namespace }}
  when: jupyter_installed.stdout | int >= 1
  ignore_errors: true

- name: Delete Jupyter resources
  shell: kubectl get {{ item }} | egrep 'jupyter|notebook' | awk '{print $1}' | xargs kubectl delete {{ item }}
  loop:
    - pvc
    - configmap
  ignore_errors: true
